<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Panel ‚Äî Vibrant Flight</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background: #000;
        color: #fff;
        font-family: "Poppins", sans-serif;
      }
      .glass {
        background: rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      input,
      textarea,
      select {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        outline: none;
        color: #fff;
        padding: 8px;
        border-radius: 8px;
        width: 100%;
        font-size: 14px;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
      }

      /* Custom dropdown arrow */
      select {
        background-image: url("data:image/svg+xml;charset=UTF-8,<svg fill='white' height='16' viewBox='0 0 24 24' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 12px;
        padding-right: 30px;
        cursor: pointer;
      }

      /* Dropdown options */
      select option {
        background-color: #111;
        color: #fff;
      }

      select:hover,
      input:hover,
      textarea:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      select:focus,
      input:focus,
      textarea:focus {
        background: rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body class="px-6 py-10">
    <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-yellow-400"> Admin Panel</h1>
    <button
      onclick="window.location.href='index.html'"
      class="bg-yellow-400 text-black px-4 py-2 rounded-lg font-semibold hover:bg-yellow-500 transition"
    >
       Home
    </button>
  </div>

    <!-- Add Product Form -->
    <form id="productForm" class="glass p-6 rounded-2xl mb-10 space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <input id="name" placeholder="Product Name" required />
        <input id="price" type="number" placeholder="Price" required />
        <input id="originalPrice" type="number" placeholder="Original Price (optional)" />
        <input id="discount" type="number" placeholder="Discount (%) optional" />
        <input id="stock" type="number" placeholder="Stock" required />
        <select id="category">
          <option value="">Select Category</option>
          <option value="tshirt">T-Shirts</option>
          <option value="shirt">Shirts</option>
          <option value="jeans">Jeans</option>
          <option value="chinos">Chinos</option>
          <option value="accessory">Accessories</option>
        </select>
      </div>

      <!-- Images (comma separated) -->
      <textarea
        id="images"
        placeholder="Image URLs (comma separated)"
        rows="2"
      ></textarea>

      <!-- Description -->
      <textarea
        id="desc"
        placeholder="Description"
        rows="4"
        required
      ></textarea>

      <!-- Sizes -->
      <input id="sizes" placeholder="Available Sizes (comma separated, e.g., S,M,L,XL)" />

      <!-- Add Button -->
      <button
        class="bg-yellow-400 text-black px-6 py-2 rounded-lg font-semibold hover:bg-yellow-500"
      >
        Add Product
      </button>
    </form>

    <h2 class="text-2xl mb-4 text-yellow-300">üßæ Current Products</h2>
    <div
      id="adminProducts"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
    ></div>

    <script>
      const BASE = "http://localhost:5000";
      const form = document.getElementById("productForm");
      const adminProducts = document.getElementById("adminProducts");

      // Input elements
      const nameInput = document.getElementById("name");
      const priceInput = document.getElementById("price");
      const originalPriceInput = document.getElementById("originalPrice");
      const discountInput = document.getElementById("discount");
      const categoryInput = document.getElementById("category");
      const descInput = document.getElementById("desc");
      const stockInput = document.getElementById("stock");
      const sizesInput = document.getElementById("sizes");
      const imagesInput = document.getElementById("images");

      let PRODUCTS = [];

      // Load all products
      async function loadProducts() {
        try {
          const res = await fetch(`${BASE}/api/products`);
          const data = await res.json();
          PRODUCTS = data;
          renderAdminList();
        } catch (err) {
          console.error("‚ùå Error loading products:", err);
        }
      }

      // Render products
      function renderAdminList() {
        adminProducts.innerHTML = "";
        if (PRODUCTS.length === 0) {
          adminProducts.innerHTML =
            "<p class='text-gray-400'>No products found.</p>";
          return;
        }

        PRODUCTS.forEach((p) => {
          const div = document.createElement("div");
          const mainImage = p.images?.[0] || p.img || "";
          div.className = "glass p-4 rounded-xl space-y-2";
          div.innerHTML = `
            <img src="${mainImage}" class="w-full h-48 object-cover rounded-lg">
            <h3 class="font-semibold">${p.name}</h3>
            <p class="text-sm text-gray-400">‚Çπ${p.price}</p>
            <p class="text-xs text-gray-500">${p.category}</p>
            <p class="text-xs text-gray-400 truncate">${p.description || ""}</p>
            <button onclick="removeProduct('${p._id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">Delete</button>
          `;
          adminProducts.appendChild(div);
        });
      }

      // Delete product
      async function removeProduct(id) {
        if (!confirm("Are you sure you want to delete this product?")) return;
        try {
          await fetch(`${BASE}/api/products/${id}`, {
            method: "DELETE",
          });
          PRODUCTS = PRODUCTS.filter((p) => p._id !== id);
          renderAdminList();
        } catch (err) {
          console.error("‚ùå Error deleting product:", err);
        }
      }

      // Add product
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const product = {
          name: nameInput.value.trim(),
          price: +priceInput.value,
          originalPrice: +originalPriceInput.value || null,
          discount: +discountInput.value || null,
          category: categoryInput.value,
          description: descInput.value.trim(),
          stock: +stockInput.value,
          sizes: sizesInput.value
            ? sizesInput.value.split(",").map((s) => s.trim())
            : [],
          images: imagesInput.value
            ? imagesInput.value.split(",").map((url) => url.trim())
            : [],
        };

        try {
          const res = await fetch(`${BASE}/api/products`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(product),
          });
          const data = await res.json();
          PRODUCTS.push(data);
          renderAdminList();
          form.reset();
        } catch (err) {
          console.error("‚ùå Error adding product:", err);
        }
      });

      loadProducts();
    </script>
  </body>
</html>
